var ShopWindow=function(t,s){this.bg=new cc.Sprite("#gui_shop_back"),this.bg.setPosition(.5*cc.winSize.width,.5*cc.winSize.height);var e=new cc.Sprite("#btn_scroll_down");e.setScale(.95);var i=new cc.MenuItemSprite(new cc.Sprite("#btn_scroll_down"),e,this.onScrollDown,this);i.setPosition(.5*this.bg.width,55),(e=new cc.Sprite("#btn_scroll_up")).setScale(.95);var o=new cc.MenuItemSprite(new cc.Sprite("#btn_scroll_up"),e,this.onScrollUp,this);o.setPosition(.5*this.bg.width,this.bg.height-160),(e=new cc.Sprite("#btn_picks")).setScale(.95);var r=new cc.MenuItemSprite(new cc.Sprite("#btn_picks"),e,this.onPicks,this);r.setPosition(80,this.bg.height-80),(e=new cc.Sprite("#btn_helpers")).setScale(.95);var c=new cc.MenuItemSprite(new cc.Sprite("#btn_helpers"),e,this.onHelpers,this);c.setPosition(187,this.bg.height-80),(e=new cc.Sprite("#btn_soils")).setScale(.95);var l=new cc.MenuItemSprite(new cc.Sprite("#btn_soils"),e,this.onSoils,this);l.setPosition(293,this.bg.height-80),(e=new cc.Sprite("#btn_chest")).setScale(.95);var h=new cc.MenuItemSprite(new cc.Sprite("#btn_chest"),e,this.onChests,this);h.setPosition(399,this.bg.height-80);var n=new cc.Menu(r,c,l,h,i,o);n.setPosition(0,0);var a=new cc.ScrollView;this.costLabelse=fillPickList(a,this.bg,t),this.pickList=a,a=new cc.ScrollView,this.helperLabels=[],this.helperLabelsSoil=[],this.helperLabelsRubies=[],fillHelpersList(a,this.bg,t,this.helperLabels,this.helperLabelsSoil,this.helperLabelsRubies),this.helperList=a,this.helperList.setVisible(!1),a=new cc.ScrollView,this.costSoilLabel=fillSoilsList(a,this.bg,t),this.soilList=a,this.soilList.setVisible(!1),a=new cc.ScrollView,this.chestIcons=[],this.chestLabels=fillChestList(a,this.bg,t,this.chestIcons),this.chestList=a,this.chestList.setVisible(!1),this.bg.addChild(this.pickList),this.bg.addChild(this.helperList),this.bg.addChild(this.soilList),this.bg.addChild(this.chestList),this.bg.addChild(n),t.addChild(this.bg),this.list=this.pickList,this.cbClose=s,this.context=t};ShopWindow.prototype={onTouchBegan:function(t){var s=this.bg.convertToNodeSpace(t.getLocation()),e=this.bg.getContentSize(),i=cc.rect(435,e.height-82,e.width-435,82);cc.rectContainsPoint(i,s)&&(this.show(!1),this.cbClose.call(this.context))},show:function(t){this.list.setVisible(t),this.bg.setVisible(t),t&&(this.list==this.soilList?this.refreshSoilCost():this.list==this.helperList&&this.refreshHelpersLebeslSoilRubies(),this.list!=this.helperList&&this.list!=this.chestList&&this.list.showContentBottom(0))},isOpen:function(){return this.bg.visible},onPicks:function(){this.list!=this.pickList&&(this.list.setVisible(!1),this.pickList.setVisible(!0),this.pickList.showContentBottom(0),this.list=this.pickList)},onHelpers:function(){this.list!=this.helperList&&(this.list.setVisible(!1),this.helperList.setVisible(!0),this.refreshHelpersLebeslSoilRubies(),this.list=this.helperList)},onSoils:function(){this.list!=this.soilList&&(this.list.setVisible(!1),this.soilList.setVisible(!0),this.refreshSoilCost(),this.soilList.showContentBottom(0),this.list=this.soilList)},onChests:function(){this.list!=this.chestList&&(this.list.setVisible(!1),this.chestList.setVisible(!0),this.list=this.chestList)},onScrollDown:function(){this.list.scrollContent(150,.1)},onScrollUp:function(){this.list.scrollContent(-150,.1)},refreshPickList:function(){this.pickList.removeAllChildren(!0),this.costLabelse=null,this.costLabelse=fillPickList(this.pickList,this.bg,this.context),this.pickList.showContentBottom(-150),this.pickList.scrollContent(150,.25)},refreshPickLabels:function(){var t=setPicks[this.context.pick.data.type+1];if(void 0!==t){t.cost_picks&&this.costLabelse[0].setColor(t.cost_picks>playerData.picks?cc.color(240,30,30):cc.color(30,240,30));for(var s=0,e=0;e<t.res_cost.length;++e)t.res_cost[e]&&this.costLabelse[++s].setColor(t.res_cost[e]>playerData.res[e+3]?cc.color(240,30,30):cc.color(30,240,30));this.costLabelse[++s].setColor(t.rubyCost>playerData.rubies[t.rubyType]?cc.color(240,30,30):cc.color(30,240,30))}},refreshHelperLabels:function(){for(var t=0;t<this.helperLabels.length;++t)this.helperLabels[t].setColor(setHelpers[t].cost>playerData.picks?cc.color(240,30,30):cc.color(30,240,30))},refreshHelpersLebeslSoilRubies:function(){for(var t=0,s=0;s<setHelpers.length;++s)this.helperLabelsSoil[s]&&this.helperLabelsSoil[s].setColor(setHelpers[s].soilCost>playerData.res[s]?cc.color(240,30,30):cc.color(30,240,30)),this.helperLabelsRubies[t]&&this.helperLabelsRubies[t].setColor(setHelpers[s].ruby1Cost>playerData.rubies[setHelpers[s].ruby1Type]?cc.color(240,30,30):cc.color(30,240,30)),++t,this.helperLabelsRubies[t]&&this.helperLabelsRubies[t].setColor(setHelpers[s].ruby2Cost>playerData.rubies[setHelpers[s].ruby2Type]?cc.color(240,30,30):cc.color(30,240,30)),++t},refreshCurrentList:function(){this.list==this.helperList?this.refreshHelperLabels():this.list==this.pickList?this.refreshPickLabels():this.list==this.chestList&&this.refreshChestList()},refreshHelperCost:function(t){this.helperLabels[t].setString(cc.loader.getRes(res.strings).p+setHelpers[t].cost.toString()),t<9&&this.helperLabelsSoil[t].setString(setHelpers[t].soilCost.toString());var s=2*t;setHelpers[t].ruby1Type>-1&&this.helperLabelsRubies[s].setString(setHelpers[t].ruby1Cost.toString()),setHelpers[t].ruby2Type>-1&&this.helperLabelsRubies[s+1].setString(setHelpers[t].ruby2Cost.toString()),this.refreshHelpersLebeslSoilRubies()},refreshSoilCost:function(){playerData.soilsAllowed<9&&this.costSoilLabel.setColor(500>playerData.res[playerData.soilsAllowed-1]?cc.color(240,30,30):cc.color(30,240,30))},refreshSoilList:function(){this.costSoilLabel=null,this.soilList.removeAllChildren(!0),this.costSoilLabel=fillSoilsList(this.soilList,this.bg,this.context),this.soilList.showContentBottom(-150),this.soilList.scrollContent(150,.25)},refreshChestList:function(){this.chestLabels[0].setColor(setChest[0]>playerData.picks?cc.color(240,30,30):cc.color(30,240,30)),this.chestLabels[1].setColor(setChest[1]>playerData.picks?cc.color(240,30,30):cc.color(30,240,30))},refreshChestLabels:function(t){this.chestLabels[t].setString(cc.loader.getRes(res.strings).p+setChest[t].toString())},openChest:function(t){this.chestIcons[t].setSpriteFrame("chest_open")},closeChests:function(t){this.chestIcons[t].setSpriteFrame("chest")}};var shop_button_x=365,shop_button_y=107,fillPickList=function(t,s,e){var i=[],o=cc.loader.getRes(res.strings),r=getFontSizeByLang();t.initWithViewSize(cc.size(s.width,s.height-280),null),t.y=90;var c=s.height-360,l=e.pick.data.type+2;l>8&&(l=8);for(var h=0;h<l;h++){var n=new cc.Sprite("#gui_shop_item_slot");n.setPosition(.5*s.width,c),t.addChild(n),c-=150;var a=new cc.Sprite("#pick_"+h.toString());a.setScale(.8),a.setPosition(70,80),n.addChild(a);var p=new cc.LabelTTF(o.damage+setPicks[h].damage.toString(),"Press Start 2P",r[0]);if(p.setPosition(125,120),p.anchorX=0,n.addChild(p),h==e.pick.data.type){var b=new cc.Sprite("#equip");b.setPosition(shop_button_x,shop_button_y),n.addChild(b)}else if(h==l-1&&h<8){setPicks[h].cost_picks&&((L=new cc.LabelTTF(o.p+setPicks[h].cost_picks.toString(),"Press Start 2P",r[1])).setColor(setPicks[h].cost_picks>playerData.picks?cc.color(240,30,30):cc.color(30,240,30)),L.setPosition(125,92),L.anchorX=0,n.addChild(L),i.push(L));for(var d=setPicks[h].res_cost,S=160,u=0;u<d.length;u++)if(d[u]){var w=new cc.Sprite("#box_soil_0"+(u+4).toString());w.setPosition(S,52);var L=new cc.LabelTTF(d[u].toString(),"Press Start 2P",17);d[u]>playerData.res[u+3]?L.setColor(cc.color(240,30,30)):L.setColor(cc.color(30,240,30)),L.setPosition(.5*w.width,-13),w.addChild(L),S+=75,n.addChild(w),i.push(L)}var C=new cc.Sprite("#rubies_"+setPicks[h].rubyType.toString());C.setPosition(S,55),n.addChild(C);var g=new cc.LabelTTF(setPicks[h].rubyCost.toString(),"Press Start 2P",17);g.setColor(setPicks[h].rubyCost>playerData.rubies[setPicks[h].rubyType]?cc.color(240,30,30):cc.color(30,240,30)),g.setPosition(.5*C.width,-14),C.addChild(g),i.push(g);var y=new cc.Sprite("#btn_buy");y.setScale(.95);var P=new cc.MenuItemSprite(new cc.Sprite("#btn_buy"),y,e.tryPickBuy,e),_=new cc.Menu(P);_.setPosition(shop_button_x,shop_button_y),n.addChild(_)}}return t.setContentSize(520,150*l+5),i},fillHelpersList=function(t,s,e,i,o,r){var c=cc.loader.getRes(res.strings),l=getFontSizeByLang();t.initWithViewSize(cc.size(s.width,s.height-280),null),t.y=90;for(var h=s.height-360,n=0;n<10;n++){var a=new cc.Sprite("#gui_shop_item_slot");a.setPosition(.5*s.width,h),t.addChild(a),h-=150;var p=new cc.Sprite(framesHelper[n]);p.anchorY=0,p.setPosition(68,12),a.addChild(p);var b=new cc.Sprite("#btn_buy");b.setScale(.95);var d=new cc.MenuItemSprite(new cc.Sprite("#btn_buy"),b,e.tryHelperBuy,e);d.idb=n;var S=new cc.Menu(d);if(S.setPosition(shop_button_x,shop_button_y),a.addChild(S),n<9){var u="#box_soil_0"+(n+1).toString(),w=new cc.Sprite(u);w.setPosition(148,110);var L=new cc.LabelTTF("+1","Press Start 2P",18);L.anchorX=0,L.setPosition(178,108),a.addChild(w),a.addChild(L),(w=new cc.Sprite(u)).setPosition(309,52);var C=new cc.LabelTTF(setHelpers[n].soilCost.toString(),"Press Start 2P",17);setHelpers[n].soilCost>playerData.res[n]?C.setColor(cc.color(240,30,30)):C.setColor(cc.color(30,240,30)),C.setPosition(.5*w.width,-13),w.addChild(C),a.addChild(w),(g=new cc.LabelTTF(c.pps+"+"+setHelpers[n].pps,"Press Start 2P",l[0])).setPosition(125,65),g.anchorX=0,a.addChild(g),o.push(C)}else{var g;(g=new cc.LabelTTF(c.crit,"Press Start 2P",15)).setPosition(125,80),g.anchorX=0,a.addChild(g)}(C=new cc.LabelTTF(c.p+setHelpers[n].cost.toString(),"Press Start 2P",l[1])).setPosition(125,20),C.anchorX=0,a.addChild(C),i.push(C);var y,P=367;setHelpers[n].ruby1Type>-1?((y=new cc.Sprite("#rubies_"+setHelpers[n].ruby1Type.toString())).setPosition(P,53),(C=new cc.LabelTTF(setHelpers[n].ruby1Cost.toString(),"Press Start 2P",17)).setColor(setHelpers[n].ruby1Cost>playerData.rubies[setHelpers[n].ruby2Type]?cc.color(240,30,30):cc.color(30,240,30)),C.setPosition(.5*y.width,-14),y.addChild(C),a.addChild(y),P+=58,r.push(C)):r.push(null),setHelpers[n].ruby2Type>-1?((y=new cc.Sprite("#rubies_"+setHelpers[n].ruby2Type.toString())).setPosition(P,53),(C=new cc.LabelTTF(setHelpers[n].ruby2Cost.toString(),"Press Start 2P",17)).setColor(setHelpers[n].ruby2Cost>playerData.rubies[setHelpers[n].ruby2Type]?cc.color(240,30,30):cc.color(30,240,30)),C.setPosition(.5*y.width,-14),y.addChild(C),a.addChild(y),r.push(C)):r.push(null)}t.setContentSize(520,1505)},fillSoilsList=function(t,s,e){var i=null;t.initWithViewSize(cc.size(s.width,s.height-280),null),t.y=90;var o=s.height-360,r=playerData.soilsAllowed+1;r>9&&(r=9);for(var c=0;c<r;c++){var l=new cc.Sprite("#gui_shop_item_slot");l.setPosition(.5*s.width,o),t.addChild(l),o-=150;var h=new cc.Sprite("#box_soil_0"+(c+1).toString());if(h.setScale(2),h.setPosition(68,70),l.addChild(h),c==r-1&&playerData.soilsAllowed<9){var n=new cc.Sprite("#box_soil_0"+c.toString());n.setPosition(160,70),l.addChild(n);var a=new cc.LabelTTF("500","Press Start 2P",18);a.setPosition(.5*n.width,-13),a.setColor(500>playerData.res[c-1]?cc.color(240,30,30):cc.color(30,240,30)),n.addChild(a),i=a;var p=new cc.Sprite("#btn_buy");p.setScale(.95);var b=new cc.MenuItemSprite(new cc.Sprite("#btn_buy"),p,e.trySoilBuy,e),d=new cc.Menu(b);d.setPosition(shop_button_x,shop_button_y),l.addChild(d)}}return t.setContentSize(520,150*r+5),i},fillChestList=function(t,s,e,i){var o=cc.loader.getRes(res.strings),r=getFontSizeByLang();t.initWithViewSize(cc.size(s.width,s.height-280),null),t.y=90;for(var c=s.height-360,l=[],h=[o.box_soils,o.box_gems],n=0;n<2;n++){var a=new cc.Sprite("#gui_shop_item_slot");a.setPosition(.5*s.width,c),t.addChild(a),c-=150;var p=new cc.Sprite("#chest");p.anchorY=0,p.setScale(.8),p.setPosition(68,28),a.addChild(p),i.push(p),(S=new cc.LabelTTF(o.p+setChest[n].toString(),"Press Start 2P",r[0])).setPosition(125,20),S.setColor(setChest[n]>playerData.picks?cc.color(240,30,30):cc.color(30,240,30)),S.anchorX=0,a.addChild(S);var b=new cc.Sprite("#btn_buy");b.setScale(.95);var d=new cc.MenuItemSprite(new cc.Sprite("#btn_buy"),b,e.tryChestBuy,e);d.idb=n;var S,u=new cc.Menu(d);u.setPosition(shop_button_x,shop_button_y),a.addChild(u),l.push(S),(S=new cc.LabelTTF(h[n],"Press Start 2P",r[0])).setAnchorPoint(0,0),S.setPosition(125,60),a.addChild(S)}return t.setContentSize(520,305),l};